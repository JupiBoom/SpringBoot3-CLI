<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rosy.main.mapper.ForumPostMapper">

    <resultMap id="ForumPostVOResultMap" type="com.rosy.main.domain.vo.ForumPostVO">
        <id column="id" property="id"/>
        <result column="activity_id" property="activityId"/>
        <result column="activity_title" property="activityTitle"/>
        <result column="user_id" property="userId"/>
        <result column="user_name" property="userName"/>
        <result column="user_avatar" property="userAvatar"/>
        <result column="title" property="title"/>
        <result column="content" property="content"/>
        <result column="cover_image" property="coverImage"/>
        <result column="view_count" property="viewCount"/>
        <result column="like_count" property="likeCount"/>
        <result column="reply_count" property="replyCount"/>
        <result column="is_top" property="isTop"/>
        <result column="status" property="status"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>

    <select id="selectForumPostDetail" resultMap="ForumPostVOResultMap">
        SELECT fp.id, fp.activity_id, a.title as activity_title, fp.user_id,
               fp.user_name, u.avatar as user_avatar, fp.title, fp.content,
               fp.cover_image, fp.view_count, fp.like_count, fp.reply_count,
               fp.is_top, fp.status, fp.create_time, fp.update_time
        FROM forum_post fp
        LEFT JOIN activity a ON fp.activity_id = a.id
        LEFT JOIN user u ON fp.user_id = u.id
        WHERE fp.id = #{id} AND fp.is_deleted = 0
    </select>

    <select id="selectByActivityId" resultMap="ForumPostVOResultMap">
        SELECT fp.id, fp.activity_id, a.title as activity_title, fp.user_id,
               fp.user_name, u.avatar as user_avatar, fp.title, fp.content,
               fp.cover_image, fp.view_count, fp.like_count, fp.reply_count,
               fp.is_top, fp.status, fp.create_time, fp.update_time
        FROM forum_post fp
        LEFT JOIN activity a ON fp.activity_id = a.id
        LEFT JOIN user u ON fp.user_id = u.id
        WHERE fp.activity_id = #{activityId} AND fp.is_deleted = 0 AND fp.status = 1
        ORDER BY fp.is_top DESC, fp.create_time DESC
    </select>

    <select id="selectByUserId" resultMap="ForumPostVOResultMap">
        SELECT fp.id, fp.activity_id, a.title as activity_title, fp.user_id,
               fp.user_name, u.avatar as user_avatar, fp.title, fp.content,
               fp.cover_image, fp.view_count, fp.like_count, fp.reply_count,
               fp.is_top, fp.status, fp.create_time, fp.update_time
        FROM forum_post fp
        LEFT JOIN activity a ON fp.activity_id = a.id
        LEFT JOIN user u ON fp.user_id = u.id
        WHERE fp.user_id = #{userId} AND fp.is_deleted = 0
        ORDER BY fp.create_time DESC
    </select>

</mapper>
