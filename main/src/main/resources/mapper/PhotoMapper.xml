<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rosy.main.mapper.PhotoMapper">

    <resultMap id="PhotoVOResultMap" type="com.rosy.main.domain.vo.PhotoVO">
        <id column="id" property="id"/>
        <result column="activity_id" property="activityId"/>
        <result column="user_id" property="userId"/>
        <result column="user_name" property="userName"/>
        <result column="user_avatar" property="userAvatar"/>
        <result column="photo_url" property="photoUrl"/>
        <result column="thumbnail_url" property="thumbnailUrl"/>
        <result column="description" property="description"/>
        <result column="is_cover" property="isCover"/>
        <result column="like_count" property="likeCount"/>
        <result column="status" property="status"/>
        <result column="create_time" property="createTime"/>
    </resultMap>

    <select id="selectByActivityId" resultMap="PhotoVOResultMap">
        SELECT p.id, p.activity_id, p.user_id, p.user_name, u.avatar as user_avatar,
               p.photo_url, p.thumbnail_url, p.description, p.is_cover,
               p.like_count, p.status, p.create_time
        FROM photo p
        LEFT JOIN user u ON p.user_id = u.id
        WHERE p.activity_id = #{activityId} AND p.is_deleted = 0 AND p.status = 1
        ORDER BY p.is_cover DESC, p.create_time DESC
    </select>

    <select id="selectByUserId" resultMap="PhotoVOResultMap">
        SELECT p.id, p.activity_id, p.user_id, p.user_name, u.avatar as user_avatar,
               p.photo_url, p.thumbnail_url, p.description, p.is_cover,
               p.like_count, p.status, p.create_time
        FROM photo p
        LEFT JOIN user u ON p.user_id = u.id
        WHERE p.user_id = #{userId} AND p.is_deleted = 0
        ORDER BY p.create_time DESC
    </select>

</mapper>
